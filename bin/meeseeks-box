#!/usr/bin/env python3

import sys
import logging
import signal

from meeseeks.util import *
from meeseeks.box import Box

def signal_stop(*args):
    logging.debug(args)
    box.shutdown.set()

def signal_reload(*args):
    logging.debug(args)
    box.apply_config(**config())

def config():
    cfgargs,args=cmdline_parser(sys.argv[1:])
    cfg=merge(read_cfg_files(args),cfgargs)
    logging.basicConfig(**cfg.get('logging',{'level':logging.INFO}))
    return cfg

box=Box(**config())

signal.signal(signal.SIGINT,signal_stop)
signal.signal(signal.SIGTERM,signal_stop)
signal.signal(signal.SIGHUP,signal_reload)

box.run()
